# ControlHeatPump
Контроллер теплового насоса

Версия 1.196.<br>
<br>
Проект "Народный контроллер" для тепловых насосов.<br>
Данное програмноое обеспечение предназначено для управления<br>
различными типами тепловых насосов для отопления и ГВС.<br>
<br>
Плата для контроллера, более продробно описана здесь: http://vad-7.blogspot.com/2021/04/HPboard.html
<br>
Гребер и БОМ лист в папке: Arduino DUE shield<br>
<br>
На плате:<br>
1. Разъемы для установки Arduino DUE R3<br>
2. Проводная сеть (W5500) для доступа к контроллеру через интернет<br>
3. Две раздельные линии для цифровых датчиков температуры DS18B20, одна из которых может быть 2-х проводной.<br>
4. Разъем для micro SD карты<br>
5. Флеш-память для веб морды<br>
6. Память 128кбайт для настроек и лога<br>
7. Часы с батарейкой CR2032<br>
8. Опора точного напряжения для аналоговых входов (нужно переключить режим на Arduino DUE)<br>
9. Подключение символьного дисплея LCD 16x2-20x4, доступен также графический Nextion.<br>
10. ЭРВ с униполярной катушкой<br>
11. 2 входа токовая петля 4-20мА<br>
12. 4 аналоговых входа с делителем напряжения<br>
13. 6 цифровых полностью изолированных входов с раздельным подключением изолированного источника напряжения.<br>
14. 2 аналоговых выхода 0-10V<br>
15. Выход на платы реле (до 12 реле)<br>
16. 1 высокоскоростной ШИМ<br>
17. 2 изолированных DC выхода<br>
18. 4 сериал порта<br>
19. 2 шины I2C<br>
20. 6 неизолированных многоцелевых (включая ШИМ) входов-выходов.<br>
21. Зуммер на 12V<br>
22. Разъем для 4-х кнопок.<br>
<br>
Размер 176x120 мм, Arduino DUE выступает на 16 мм.<br>
<img src="https://github.com/vad7/ControlHeatPump/blob/master/Arduino%20DUE%20shield/Project_Arduino%20DUE%20shield%20-%20Board%203D.jpg?raw=trueimg.png" alt="qr"/>
<br>
<br>
1. Поддержка символьного дисплея 20x4 символов (LCD2004), может работать совместно с Nextion.<br>
2. ТН Воздух-Вода - полная поддержка, установка оборотов компрессора, ЭРВ.<br>
3. Ежесуточные реле - переключение по температуре и по ночному тарифу<br>
4. Дамп ячеек Modbus, загрузка файла дампа в устройство Modbus<br>
5. Частотник Vacon: управление вентилятором, настройка мощности, контроль температуры, авто-сброс ошибки связи<br>
6. Дисплей Nextion: описание ошибки ТН текстом на главном экране, отображение второго уличного датчика, исправление ошибок<br>
7. Исправление множества ошибок в функциях: EEV, WR, Vacon, COP, Pumps, web<br>
8. Корректировка ЭРВ при переходе отопление-бойлер<br>
9. Опция включения циркуляционного насоса ГВС по расписанию<br>
10. Возможность изменять аварийные границы датчиков температур через веб<br>
11. Ограничение оборотов компрессора по времени<br>
12. ГВС: использовать только тэн во время "расписание только для тэна"<br>
13. Не считать статистику с меткой "во время работы" в переходных моментах бойлер-отопление и при возврате масла<br>
14. Статистика - отдельно считается тэн бойлера<br>
15. Пересоздание stats файлов при ошибке последовательности или длине=0<br>
16. Исправление работы насосов в паузе<br>
17. Исправление синхронизации времени, запрет смены часов во время работы ТН<br>
18. Исправление скролбара в веб<br>
19. Опция запрещать смену конкретного расписания<br>
20. Исправление безопасного доступа через веб, из-за кэширования он не работал адекватно<br>
21. Опция продолжения отопления после нагрева бойлера, если внутри гистерезиса<br>
22. Отображение на веб о включении суточных реле<br>
23. Корректировка минимальной мощности ваттроутера в зависимости текущей мощности с MPPT<br>
24. Поддержку двунаправленного электро-счетчика DDS238-2 ZN/S<br>
25. Настройки насосов отопления и дополнительного тэна перенесены в профили<br>
26. Новый режим работы дополнительного тэна на выходе ТН - интеллектуальный, теперь их три: по дому, по улице, интеллектуально<br>
27. Температура цели бойлера на схеме<br>
28. Корректировка датчиков WiFi (esp8266)<br>
29. Нагрев бойлера во время отсутствия электричества, если есть солнце<br>
30. Перенос настройки выключения насоса после останова компрессора в профили, отдельная задача по управлению насосами, чтобы была возможность контроля температур цели.<br>
31. Автопереключение режима работы - Отопление / Охлаждение<br>
32. Возможность использовать несколько периодов включения одного и того же ежесуточного реле.<br>
33. Возможность задать дополнительно любой датчик температуры как цель отопления. Расписание по часам контроля этих датчиков для каждого профиля.<br>
34. Догрев бойлера тэном во время паузы компрессора и низкой температуры или когда не смог нагреть с первого раза.<br>
35. Управление теплым полом по датчикам теплого пола. Два режима - по превышению на заданную дельту целевой температуры или по целевой температуре датчика.<br>
36. Старт нагрева по минимальной температуре подачи.<br>
37. Максимальная температура цели для принудительного останова цикла нагрева, если по другим датчикам еще нужно греть.  <br>
38. Поддержка частотников Danfoss VLT, Danfoss Micro Drive FC-51.<br>
39. Управления дополнительным солнечным подкачивающим инвертором (через реле).<br>
40. Подсчет потребления по дневному/ночному тарифу раздельно, опциональное.<br>

<br><br>

Подробное обсуждение проекта на форуме: <br>
https://www.forumhouse.ru/threads/492563/


Скриншеты веб-интерфейса:

![Состояние](https://user-images.githubusercontent.com/6220128/56410007-3079bb00-6284-11e9-829b-f6a959f91073.png)
![Схема](https://user-images.githubusercontent.com/6220128/132807406-91645390-40a1-4f1e-b3aa-529ab1eba872.png)
![ЭРВ](https://user-images.githubusercontent.com/6220128/56410010-3079bb00-6284-11e9-9673-fb239037f33a.png)
![Настройки](https://user-images.githubusercontent.com/6220128/132806926-92010a49-bd0e-427d-a8c2-e4e657372f62.png)
![Расписание](https://user-images.githubusercontent.com/6220128/56410004-2fe12480-6284-11e9-8b03-78b331157580.png)
![Датчики](https://user-images.githubusercontent.com/6220128/56410001-2fe12480-6284-11e9-8cd5-69d094656276.png)
![Реле](https://user-images.githubusercontent.com/6220128/56410005-2fe12480-6284-11e9-8a4d-72b94401ffb2.png)
![Инвертор](https://user-images.githubusercontent.com/6220128/56410002-2fe12480-6284-11e9-8702-9bad735ddebe.png)
![RTOS](https://user-images.githubusercontent.com/6220128/56409998-2f488e00-6284-11e9-851b-1800e9cf688d.png)
![Графики](https://user-images.githubusercontent.com/6220128/56410245-1a202f00-6285-11e9-8991-ae68be600a8a.png)
![Графический лог](https://user-images.githubusercontent.com/6220128/56410000-2fe12480-6284-11e9-8b83-9b014c41a389.png)
![Статистика](https://user-images.githubusercontent.com/6220128/56410008-3079bb00-6284-11e9-97d6-145e7347cb60.png)
![Ваттроутер](https://user-images.githubusercontent.com/6220128/92506657-72572880-f20e-11ea-9791-e899aa069e9d.png)

Выносной экран Nextion:

![Nextion Main](https://user-images.githubusercontent.com/6220128/59842650-a15e5180-935f-11e9-894a-a86d4157c38c.png)
![Nextion Scheme](https://user-images.githubusercontent.com/6220128/59842761-d8346780-935f-11e9-878e-2635b119225a.png)
![Nextion Heat](https://user-images.githubusercontent.com/6220128/59842865-12056e00-9360-11e9-98db-e4ee1a1464a2.png)

Символьный дисплей LCD2004:

![image](https://user-images.githubusercontent.com/6220128/114034672-11b4ca80-9887-11eb-8aec-747a6301cb63.png)
